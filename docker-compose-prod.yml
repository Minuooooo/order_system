version: '3.8'
services:

  mysql:
    image: mysql:8.0
    restart: always
    ports:
      - "3306:3306"
    environment:
      MYSQL_DATABASE: order_system
      MYSQL_USER: order
      MYSQL_PASSWORD: 1234
      MYSQL_ROOT_PASSWORD: 1234

  redis:
    image: redis
    hostname: ${REDIS_HOSTNAME}
    ports:
      - "${REDIS_LOCAL_PORT}:${REDIS_SERVER_PORT}"

  app:
    image: order_system-app
    build: .
    restart: always
    ports:
      - "${APP_LOCAL_PORT}:${APP_SERVER_PORT}"
    environment:
      SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE}  # application-prod.yml 우선적으로 실행 -> application.yml 실행 (prod 파일과 겹치는 부분이 있다면 prod 가 덮어씌움)
      SPRING_DATASOURCE_URL: ${SPRING_DATASOURCE_URL}  # rds 사용할 경우 endpoint
      SPRING_DATASOURCE_USERNAME: ${SPRING_DATASOURCE_USERNAME}
      SPRING_DATASOURCE_PASSWORD: ${SPRING_DATASOURCE_PASSWORD}
    env_file: # .gitignore 에 .env 적용 시 추가
      - .env